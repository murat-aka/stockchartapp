"use strict";angular.module("stockstreamApp",["ngCookies","ngResource","ngSanitize","ngRoute","btford.socket-io","ui.bootstrap"]).config(["$routeProvider","$locationProvider",function(a,b){a.otherwise({redirectTo:"/"}),b.html5Mode(!0)}]),angular.module("stockstreamApp").controller("MainCtrl",["$scope","$http","$timeout","socket","$filter",function(a,b,c,d,e){a.awesomeThings=[],a.arrayLength=-1,a.deleted=!1;var f=new Date,g=f.getFullYear(),h=1==f.getMonth().toString().length?"0"+(f.getMonth()+1).toString():(f.getMonth()+1).toString(),i=1==f.getDate().toString().length?"0"+f.getDate().toString():f.getDate().toString(),j=(1==f.getHours().toString().length?"0"+f.getHours().toString():f.getHours().toString(),1==f.getMinutes().toString().length?"0"+f.getMinutes().toString():f.getMinutes().toString(),g+"-"+h+"-"+i);c(function(){d.unsyncUpdates("stock"),alert("Disconnects after five minutes to save server resources. Refresh page to continue using.")},3e5),a.refreshChart=function(){$("#container").highcharts({chart:{type:"line",alignTicks:!1},navigator:{enabled:!1},rangeSelector:{enabled:!1},exporting:{enabled:!1},scrollbar:{enabled:!1},legend:{enabled:!0},title:"",series:a.stocks,xAxis:{showFirstLabel:!1,showLastLabel:!1,tickLength:0,labels:{enabled:!1}},yAxis:{gridLineWidth:0,labels:{},title:{enabled:!1}},tooltip:{followPointer:!0,crosshairs:!0},credits:{enabled:!1}}),a.arrayLength=a.stocks.length},b.get("/api/stocks/").success(function(b){a.stocks=b,d.syncUpdates("stock",a.stocks,function(b,c,d){setTimeout(function(){a.refreshChart()},500)}),a.refreshChart()}),a.addStock=function(){""!==a.newStock&&($(".btn").prop("disabled",!0),$(".form-control").prop("disabled",!0),b.get("https://www.quandl.com/api/v1/datasets/WIKI/"+a.newStock+".json?sort_order=asc&exclude_headers=true&trim_start="+g+"-01-01&trim_end="+j+"&auth_token=PwyZscKorv3wCa-dEbtX").success(function(c){var f={type:"line",name:a.newStock,data:c.data.map(function(a){return[e("date")(a[0],"longDate"),a[4]]}),marker:{enabled:!1},color:a.getRandomColor()};b.post("/api/stocks",f).success(function(){$(".btn").prop("disabled",!1),$(".form-control").prop("disabled",!1),a.newStock="",b.get("/api/stocks/").success(function(b){a.stocks=b,d.syncUpdates("stock",a.stocks,function(b,c,d){setTimeout(function(){a.refreshChart()},500)}),a.refreshChart()})})}))},a.deleteStock=function(c){b["delete"]("/api/stocks/"+c._id).success(function(){b.get("/api/stocks/").success(function(b){a.stocks=b,d.syncUpdates("stock",a.stocks,function(b,c,d){a.refreshChart()}),a.refreshChart()})})},a.getRandomColor=function(){for(var a="0123456789ABCDEF".split(""),b="#",c=0;6>c;c++)b+=a[Math.floor(16*Math.random())];return b},a.$on("$destroy",function(){d.unsyncUpdates("stock")})}]),angular.module("stockstreamApp").config(["$routeProvider",function(a){a.when("/",{templateUrl:"app/main/main.html",controller:"MainCtrl"})}]),angular.module("stockstreamApp").factory("Modal",["$rootScope","$modal",function(a,b){function c(c,d){var e=a.$new();return c=c||{},d=d||"modal-default",angular.extend(e,c),b.open({templateUrl:"components/modal/modal.html",windowClass:d,scope:e})}return{confirm:{"delete":function(a){return a=a||angular.noop,function(){var b,d=Array.prototype.slice.call(arguments),e=d.shift();b=c({modal:{dismissable:!0,title:"Confirm Delete",html:"<p>Are you sure you want to delete <strong>"+e+"</strong> ?</p>",buttons:[{classes:"btn-danger",text:"Delete",click:function(a){b.close(a)}},{classes:"btn-default",text:"Cancel",click:function(a){b.dismiss(a)}}]}},"modal-danger"),b.result.then(function(b){a.apply(b,d)})}}}}}]),angular.module("stockstreamApp").controller("NavbarCtrl",["$scope","$location",function(a,b){a.menu=[{title:"Home",link:"/"}],a.isCollapsed=!0,a.isActive=function(a){return a===b.path()}}]),angular.module("stockstreamApp").factory("socket",["socketFactory",function(a){var b=io("",{path:"/socket.io-client"}),c=a({ioSocket:b});return{socket:c,syncUpdates:function(a,b,d){d=d||angular.noop,c.on(a+":save",function(a){var c=_.find(b,{_id:a._id}),e=b.indexOf(c),f="created";c?(b.splice(e,1,a),f="updated"):b.push(a),d(f,a,b)}),c.on(a+":remove",function(a){var c="deleted";_.remove(b,{_id:a._id}),d(c,a,b)})},unsyncUpdates:function(a){c.removeAllListeners(a+":save"),c.removeAllListeners(a+":remove")}}}]),angular.module("stockstreamApp").run(["$templateCache",function(a){a.put("app/main/main.html",'<div class=container><div class=row><div class=col-lg-12><h1 class=page-header>Stocks:</h1><div id=container style="width:100%; height:400px"></div><ul id=nav class="nav nav-tabs nav-stacked col-md-4 col-lg-4 col-sm-6" ng-repeat="stock in stocks" ng-init=refreshChart()><li><a href="">{{stock.name}}<button type=button class=close ng-click=deleteStock(stock)>&times;</button></a></li></ul></div></div><form class=thing-form><label>Syncs in realtime across clients</label><p class=input-group><input class=form-control placeholder="Add a new thing here." ng-model=newStock> <span class=input-group-btn><button type=submit class="btn btn-primary" ng-click=addStock()>Add New</button></span></p></form></div><footer class=footer><div class=container><p>Angular Fullstack v2.0.13 | <a href=https://twitter.com/tyhenkel>@tyhenkel</a> | <a href="https://github.com/DaftMonk/generator-angular-fullstack/issues?state=open">Issues</a></p></div></footer>'),a.put("components/modal/modal.html",'<div class=modal-header><button ng-if=modal.dismissable type=button ng-click=$dismiss() class=close>&times;</button><h4 ng-if=modal.title ng-bind=modal.title class=modal-title></h4></div><div class=modal-body><p ng-if=modal.text ng-bind=modal.text></p><div ng-if=modal.html ng-bind-html=modal.html></div></div><div class=modal-footer><button ng-repeat="button in modal.buttons" ng-class=button.classes ng-click=button.click($event) ng-bind=button.text class=btn></button></div>'),a.put("components/navbar/navbar.html",'<div class="navbar navbar-default navbar-static-top" ng-controller=NavbarCtrl><div class=container><div class=navbar-header><button class=navbar-toggle type=button ng-click="isCollapsed = !isCollapsed"><span class=sr-only>Toggle navigation</span> <span class=icon-bar></span> <span class=icon-bar></span> <span class=icon-bar></span></button> <a href="/" class=navbar-brand>stockstream</a></div><div collapse=isCollapsed class="navbar-collapse collapse" id=navbar-main><ul class="nav navbar-nav"><li ng-repeat="item in menu" ng-class="{active: isActive(item.link)}"><a ng-href={{item.link}}>{{item.title}}</a></li></ul></div></div></div>')}]);